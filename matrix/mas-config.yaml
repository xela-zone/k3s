apiVersion: v1
kind: ConfigMap
metadata:
  name: mas-config
  namespace: matrix
data:
  config.yaml: |
    # HTTP listener
    http:
      address: 0.0.0.0:8080
      public_base: https://matrix.kbrt.xyz/

    # Database connection
    database:
      uri: "postgres://mas:DB_PASSWORD_PLACEHOLDER@matrix-db-rw.matrix.svc/mas"

    # Telemetry
    telemetry:
      tracing:
        enabled: false

    # Upstream Identity Provider (Authentik)
    upstream_oauth2:
      providers:
        - id: authentik
          human_name: "Authentik"
          issuer: "https://id.kbrt.xyz/application/o/matrix/"
          client_id: "CLIENT_ID_PLACEHOLDER"
          client_secret: "CLIENT_SECRET_PLACEHOLDER"
          scope: "openid profile email"
          # Discovery mode usually works, but explicit endpoints are safer if discovery fails
          discovery_mode: oidc

    # Matrix Homeserver Integration
    matrix:
      homeserver: "http://matrix.matrix.svc:80"
      secret: "MAS_SHARED_SECRET_PLACEHOLDER"  # Synapse and MAS share this

    # Encryption keys (injected)
    secrets:
      encryption: "ENCRYPTION_KEY_PLACEHOLDER"

    # Clients (Element Web, Element X, etc.)
    clients:
      - client_id: 01HCGY0Z10896D686D746D746D
        client_auth_method: none
