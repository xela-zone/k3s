apiVersion: v1
kind: ConfigMap
metadata:
  name: mas-config
  namespace: matrix
data:
  config.yaml: |
    # HTTP listener
    http:
      address: "0.0.0.0:8080"
      public_base: "https://matrix.kbrt.xyz/"

    # Database connection
    database:
      uri: "postgres://mas:DB_PASSWORD_PLACEHOLDER@matrix-db-rw.matrix.svc.cluster.local/mas"

    # Telemetry
    telemetry:
      tracing:
        enabled: false

    # Upstream Identity Provider (Authentik)
    upstream_oauth2:
      providers:
        - id: 01HBG9Y6B0ZEDAVZZV9TZPDZZZ
          human_name: "Authentik"
          issuer: "https://id.kbrt.xyz/application/o/matrix/"
          client_id: "CLIENT_ID_PLACEHOLDER"
          client_secret: "CLIENT_SECRET_PLACEHOLDER"
          scope: "openid profile email"
          discovery_mode: oidc
          token_endpoint_auth_method: client_secret_post

    # Matrix Homeserver Integration
    matrix:
      homeserver: "https://matrix.kbrt.xyz"
      secret: "MAS_SHARED_SECRET_PLACEHOLDER"

    # Encryption keys
    secrets:
      encryption: "ENCRYPTION_KEY_PLACEHOLDER"
      session: "SESSION_SECRET_PLACEHOLDER"
      keys:
        - kid: "01HBG9Y6B0ZEDAVZZV9TZPDZZZ"
          key_file: "/data/oidc.key"

    # Minimal Policy
    policy:
      wasm: "/usr/local/share/mas-cli/policy.wasm"